<!doctype html>
<html lang="en">
  	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="Spore Engineering Token Exchange">
		<meta name="author" content="Spore Engineering, Carlos Baeza Negroni">

		<title>Spore Engineering Token Exchange</title>
		
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
		<link rel="icon" href="img/spore-swap-logo-solid.png" type="image/png">
		<link rel='stylesheet' type='text/css' media='screen' href='css/main.css'>
		<link rel='stylesheet' type='text/css' media='screen' href='css/material.bootstrap.theme.css'>

		<meta name="theme-color" content="#563d7c">

		<style>
			body {
				padding-top: 12rem;
			}
			.starter-template {
				text-align: center;
			}
		</style>
	</head>
	<body>
    	<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        	<div class="container">
        		<a class="navbar-brand" href="#">
					<img src="img/spore-swap-logo.png" width="47" height="47" class="d-inline-block align-top" alt="">
				</a>
        
				<div class="collapse navbar-collapse" id="navbarsExampleDefault">
					<ul class="navbar-nav mr-auto">
						<li class="nav-item active">
							<a class="nav-link" href="#">Exchange <span class="sr-only">(current)</span></a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="https://etherscan.io/address/0x96853087c9e364fe9554fd6fcfe13bcd942b04d5" target="_blank">Etherscan <sup>â†—</sup></a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="https://info.uniswap.org/pair/0x35b3325d1852D3C67481f09361666bF3325307Da" target="_blank">Uniswap <sup>â†—</sup></a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="https://t.me/spore_engineering" target="_blank">Telegram <sup>â†—</sup></a>
						</li>
					</ul>
				</div>

				<div style="display: none;" id="metamastUserInfoNavbar">
					<span class="badge badge-secondary wallet-address" id="metamaskUserInfoNavbarAddress"></span> 
					<span class="badge badge-pill badge-success success-msg-wallet-address">Connected</span>
				</div>
				
				<button style="display: none;" class="btn btn-info my-2 my-sm-0 login-metamask-button" type="submit" id="connectMetamaskButton"> <img src="img/metamask-fox-icon.png" height="22" alt=""> Connect Metamask</button>
  			</div>
		</nav>

		<main role="main" class="container">
			<div class="starter-template">
				<div class="row justify-content-md-center">
					<div class="col-md-6">

						<!--<div class="alert alert-dismissible alert-success mb-5">
							<button type="button" class="close" data-dismiss="alert">&times;</button>
							<strong><h4>ðŸŽ‰ Transaction Successful ðŸŽ‰</h4></strong>This is your transaction hash: <a href="#" class="alert-link">0xae159d00f093fdbf6e16688d9a703052cf093b3de6df635ff5cb7fd5cb03d552</a><br>
							<br>
							<a href="https://info.uniswap.org/pair/0x35b3325d1852D3C67481f09361666bF3325307Da" class="btn btn-success" target="_blank"><img src="img/logo_white.edb44e56.svg" class="" alt=""> Add Liquidity on Uniswap </a>
							
						</div>

						<div class="alert alert-dismissible alert-danger mb-5">
							<button type="button" class="close" data-dismiss="alert">&times;</button>
							<strong><h4>â›” Transaction Failed â›”</h4></strong>For some reason your transaction failed, please refresh the page and try again.
							
						</div>-->

						<div class="row mb-3">
							<div class="col-md-6">
								<img src="img/spore-logo-round-transparen.png" width="24" height="24" alt=""> 1 SPORE = <span id="spore-eth-placeholder"></span></span> ETH
							</div>
							<div class="col-md-6">
								<img src="img/eth-icon-logo.png" width="24" height="24" alt=""> 1 ETH = <span id="eth-spore-placeholder"></span></span> SPORE
							</div>
						</div>

						<div class="card text-white bg-dark mb-5">
							<div class="card-body">
								<ul class="nav nav-pills nav-fill">
									<li class="nav-item">
										<a class="nav-link active" data-toggle="tab" href="#buy-spore">Buy</a>
									</li>
									<li class="nav-item">
										<a class="nav-link disabled" data-toggle="tab" href="#sell-spore">Sell</a>
									</li>
									<li class="nav-item">
										<a class="nav-link disabled" data-toggle="tab" href="#pool-spore">Pool</a>
									</li>
									<li class="nav-item">
										<a class="nav-link disabled" data-toggle="tab" href="#gov-spore">Vote</a>
									</li>
								</ul>

								<div class="tab-content tabContentSpore">
									<div class="tab-pane fade active show" id="buy-spore">
										<div class="form-group">
											<label class="control-label mb-3">Please fill down below the amount of Spore Tokens you want to purchase.</label>
											<div class="form-group">
												<div class="input-group mb-5">

													
													<input type="text" class="form-control" id="input-spore-amount">
													
													<div class="input-group-append">
														<span class="input-group-text arrangementsPriceResume">
															Total: Îž<span id="total-eth-calculated"></span> &nbsp; ($<span id="total-usd-calculated"></span>)</span>
														</span>
													</div>

												</div>
											</div>
										</div>
										<button type="button" class="btn btn-info btn-lg btn-block" data-toggle="modal" data-target="#exampleModal" id="buySporeButton">Buy Spore Tokens</button>
									</div>
								</div>
							</div>

						</div>

						<!--<hr> 

						<h4 class="mb-3">ðŸ’° Spore Liquidity Program Rewards ðŸ’°<br><span class="card-footer text-muted subtitle-awards">
							Those rewards are for being a Spore liquidity provider
						</span></h4>
						

						<div class="alert alert-dismissible alert-danger">
							<button type="button" class="close" data-dismiss="alert">&times;</button>
							<img src="img/copihue-white-lines-logo.png" alt=""> <br>
							You've been invited to the pre-mining investor round for Copihue Financial, please visit the <a href="https://copihue.app" class="alert-link" target="_blank">User Dashboard</a> and sign in to your account.
						</div>-->
					</div>
				</div>
			</div>
		</main><!-- /.container -->


		<!-- Button trigger modal -->
		<!--<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
			Launch demo modal
		</button>-->

		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"><!--data-backdrop="static" data-keyboard="false"-->
			<div class="modal-dialog" role="document">
				<div class="modal-content">
				<div class="modal-body loading-transaction-text-container">
					<img src="img/loading.gif" width="250"><br>
					<span class="loading-transaction-text">Your transaction is being processed, please stand by, this screen will automatically disappear when the process it's completed âŒ›</span>
				</div>
				</div>
			</div>
		</div>
		

		<input type="number" id="spore-eth-placeholder-raw-price" value="" style="display: none;">
		<input type="number" id="eth-spore-placeholder-raw-price" value="" style="display: none;">
		<input type="number" id="eth-placeholder-raw-price" value="" style="display: none;">
		<input type="text" id="user-balance-active-account" value="" style="display: none;">

		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

		<script src="js/web3.min.js"></script>
		
		

		<script>

			const initialize = async () => {

				const loginMetamaskButton = document.getElementById('connectMetamaskButton');
				const buySporeButton = document.getElementById('buySporeButton');
				const metamastUserInfoNavbar = document.getElementById('metamastUserInfoNavbar');
				const metamaskUserInfoNavbarAddress = document.getElementById('metamaskUserInfoNavbarAddress');

				const sporePlaceholder = document.getElementById('spore-eth-placeholder');
				const ethPlaceholder = document.getElementById('eth-spore-placeholder');
				const sporePlaceholderRaw = document.getElementById('spore-eth-placeholder-raw-price');
				const ethPlaceholderRaw = document.getElementById('eth-spore-placeholder-raw-price');
				const ethPlaceholderOriginalRaw = document.getElementById('eth-placeholder-raw-price');

				const totalEthCalculated = document.getElementById('total-eth-calculated');
				const totalUsdCalculated = document.getElementById('total-usd-calculated');

				let inputSporeAmount = document.getElementById('input-spore-amount');
				let userBalanceActiveAccount = document.getElementById('user-balance-active-account');
				
				let accounts = null;
				let web3;

				const updateHeaderAccountInfo = async (address) => {
					metamaskUserInfoNavbarAddress.innerText = address;

					let userBalance = await web3.eth.getBalance(address);
					
					userBalanceActiveAccount.value = userBalance;
					
					loginMetamaskButton.style.display = 'none';
					metamastUserInfoNavbar.style.display = 'block';
				};

				const isMetaMaskInstalled = () => {
					const { ethereum } = window;
					ethereum.autoRefreshOnNetworkChange = false;

					web3 = new Web3(ethereum);

					return Boolean(ethereum && ethereum.isMetaMask && web3);
				};

				if(!isMetaMaskInstalled()) {
					loginMetamaskButton.style.display = 'block';
					loginMetamaskButton.onclick = "";
					loginMetamaskButton.innerText = 'You need to install Metamask';
					loginMetamaskButton.disabled = true;

					buySporeButton.onclick = "";
					buySporeButton.innerText = 'You need to install Metamask';
					buySporeButton.disabled = true;
				}
				else {
					
					accounts = await ethereum.request({ method: 'eth_accounts' });

					if(accounts.length > 0) {
						updateHeaderAccountInfo(accounts[0]);
					}
					else {
						loginMetamaskButton.style.display = 'block';
					}
				}

				document.querySelector('#connectMetamaskButton').addEventListener('click', async () => {
					accounts = await ethereum.request({ method: 'eth_requestAccounts' });
					updateHeaderAccountInfo(accounts[0]);
				});

				inputSporeAmount.onkeyup = (data) => {
					const sporePlaceholderRaw = document.getElementById('spore-eth-placeholder-raw-price').value * 1;
					const ethPlaceholderRaw = document.getElementById('eth-spore-placeholder-raw-price').value * 1;
					const ethPlaceholderOriginalRaw = document.getElementById('eth-placeholder-raw-price').value * 1;

					totalEthCalculated.innerText = parseFloat(inputSporeAmount.value*sporePlaceholderRaw).toFixed(5);
					totalUsdCalculated.innerText = parseFloat((inputSporeAmount.value*sporePlaceholderRaw)*ethPlaceholderOriginalRaw).toFixed(2);
				};


				const updatePairPriceInformation = () => {
					const pairAddress = "0x35b3325d1852d3c67481f09361666bf3325307da";
					const uniswapEndpoint = "https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2";

					const options = {
						method: "post",
						headers: {
							"Content-Type": "application/json"
						},
						body: JSON.stringify({
							query: `{ pair(id: "${pairAddress}") { token0 { id symbol name derivedETH } token1 { id symbol name derivedETH } reserve0 reserve1 reserveUSD trackedReserveETH token0Price token1Price volumeUSD txCount } }`
						})
					};

					const optionsPriceETH = {
						method: "post",
						headers: {
							"Content-Type": "application/json"
						},
						body: JSON.stringify({
							query: `{ bundle(id: "1") { ethPrice } }`
						})
					};

					fetch(uniswapEndpoint, options).then(response => response.json()).then(data => currentPairPriceInformation(data));
					fetch(uniswapEndpoint, optionsPriceETH).then(response => response.json()).then(data => currentPriceETH(data));
				};


				const currentPairPriceInformation = (data) => {
					sporePlaceholder.innerText = parseFloat(data.data.pair.token1Price).toFixed(5);
					ethPlaceholder.innerText = parseFloat(data.data.pair.token0Price).toFixed(5);
					sporePlaceholderRaw.value = data.data.pair.token1Price;
					ethPlaceholderRaw.value = data.data.pair.token0Price;
				};

				const currentPriceETH = (data) => {
					ethPlaceholderOriginalRaw.value = data.data.bundle.ethPrice;
				};

				updatePairPriceInformation();	

			};
			window.addEventListener('DOMContentLoaded', initialize);
		</script>
	</body>
</html>